namespace: github.com/nicholasjackson
application_name: event-sauce
docker_registry:
  url: <%= ENV['DOCKER_REGISTRY_URL'] %>
  user: <%= ENV['DOCKER_REGISTRY_USER'] %>
  password: <%= ENV['DOCKER_REGISTRY_PASS'] %>
  email: <%= ENV['DOCKER_REGISTRY_EMAIL'] %>
  namespace: <%= ENV['DOCKER_NAMESPACE'] %>
docker:
  build_image: golang:latest
  build_docker_file: ./something/something
  application_docker_file: ./dockerfiles/event-sauce/Dockerfile
  application_compose_file: ./dockercompose/event-sauce/docker-compose.yml
fetch:
  include: true
build:
  pre:
    tasks:
      - task1
      - task2
    copy:
      -
        from: <%= "#{ENV['GOPATH']}/src/github.com/nicholasjackson/event-sauce/event-sauce" %>
        to: ./docker/event-sauce
      -
        from: ./swagger_spec/swagger.yml
        to: ./dockerfile/event-sauce/swagger_spec/swagger.yml
    consul_loader:
      config_file: ./config.yml
      url: <%= "http://#{ENV['DOCKER_IP']}:9500" %>
    health_check: <%= "http://#{ENV['DOCKER_IP']}:8001/v1/health" %>
  docker:
    build_image: golang:1.7beta
  post:
    tasks:
      - task2
    copy:
      -
        from: <%= "#{ENV['GOPATH']}/src/github.com/nicholasjackson/event-sauce/event-sauce" %>
        to: ./docker/event-sauce
run:
  pre:
    consul_loader:
      config_file: ./config.yml
      url: <%= "http://#{ENV['DOCKER_IP']}:9500" %>
  docker:
    application_compose_file: ./dockercompose/event-sauce/docker-compose-alternate.yml
  post:
    tasks:
      - wait_for_elastic_search
      - wait_for_db
cucumber:
  pre:
    consul_loader:
      config_file: ./config.yml
      url: <%= "http://#{ENV['DOCKER_IP']}:9500" %>
    health_check: <%= "http://#{ENV['DOCKER_IP']}:8001/v1/health" %>
  docker:
    application_compose_file: ./dockercompose/event-sauce/docker-compose-alternate.yml
  post:
    tasks:
      - wait_for_elastic_search
